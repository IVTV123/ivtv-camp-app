<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IVTV Summer Camp 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50">
  <div id="app"></div>
  <div id="edit-modal-root"></div>
  <div id="lightbox-root"></div>
  <script>
    // ================= ICONS & HELPERS ==================
    const SVG = {
      Calendar: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>`,
      Camera: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="2" y="7" width="20" height="15" rx="2"/><circle cx="12" cy="14.5" r="3.5"/><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
      FileText: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 22h16V2H8l-4 4v16z"/><path d="M14 2v6h6"/></svg>`,
      Users: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="9" cy="7" r="4"/><path d="M17 11c0-2.21-1.79-4-4-4"/><path d="M6 21v-2c0-2.21 3.58-4 8-4s8 1.79 8 4v2"/></svg>`,
      Video: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="7" width="15" height="10" rx="2"/><polygon points="16 7 22 12 16 17 16 7"/></svg>`,
      Bell: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M18 8a6 6 0 1 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>`,
      Upload: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>`,
      Play: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>`,
      Download: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>`,
      MessageCircle: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M21 11.5A8.38 8.38 0 0 1 3.6 18.3L2 22l3.7-1.6A8.5 8.5 0 1 1 21 11.5z"/></svg>`,
      Heart: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0l-.9.9-.9-.9a5.5 5.5 0 0 0-7.8 7.8l.9.9 7.8 7.8 7.8-7.8.9-.9a5.5 5.5 0 0 0 0-7.8z"/></svg>`,
      Share2: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>`,
      Menu: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>`,
      X: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
      CameraLarge: `<svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="2" y="7" width="20" height="15" rx="2"/><circle cx="12" cy="14.5" r="3.5"/><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
      VideoLarge: `<svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="7" width="15" height="10" rx="2"/><polygon points="16 7 22 12 16 17 16 7"/></svg>`,
      FileTextLarge: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 22h16V2H8l-4 4v16z"/><path d="M14 2v6h6"/></svg>`,
      VideoRed: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="7" width="15" height="10" rx="2"/><polygon points="16 7 22 12 16 17 16 7"/></svg>`,
      CameraRed: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="2" y="7" width="20" height="15" rx="2"/><circle cx="12" cy="14.5" r="3.5"/><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`
    };
    function getTimeAgo(dateStr) {
      const now = new Date();
      const then = new Date(dateStr);
      const sec = Math.floor((now - then) / 1000);
      if (sec < 60) return sec === 1 ? "1 second ago" : sec + " seconds ago";
      const min = Math.floor(sec / 60);
      if (min < 60) return min === 1 ? "1 minute ago" : min + " minutes ago";
      const hr = Math.floor(min / 60);
      if (hr < 24) return hr === 1 ? "1 hour ago" : hr + " hours ago";
      const days = Math.floor(hr / 24);
      return days === 1 ? "1 day ago" : days + " days ago";
    }
    function getCurrentCampWeek(state) {
      const today = new Date();
      for (let i = 0; i < (state.campCalendar || []).length; ++i) {
        const week = state.campCalendar[i];
        const start = new Date(week.start);
        const end = new Date(week.end);
        if (today >= start && today <= end) return { ...week, idx: i };
      }
      for (let i = 0; i < (state.campCalendar || []).length; ++i) {
        const week = state.campCalendar[i];
        if (new Date(week.start) > today) return { ...week, idx: i };
      }
      return state.campCalendar && state.campCalendar[state.campCalendar.length - 1] || null;
    }

    // ================= STATE & LOCALSTORAGE ==================
    const state = {
      activeTab: 'dashboard',
      mobileMenuOpen: false,
      isAdmin: false,
      showAdminLogin: false,
      adminPassword: '',
      showNewPostForm: false,
      showNewFileForm: false,
      editingPost: null,
      expandedPost: null,
      homepageHeroTitle: 'Welcome to IVTV Summer Camp',
      homepageHeroSubtitle: 'Professional TV Production Training â€¢ Summer 2025',
      homepageBoxes: [
        {}, {}, {
          title: "Files Shared",
          icon: "FileText",
          text: "Equipment lists and project guidelines",
          bottomLabel: "Total files:",
          bottomValue: () => state.files.length
        }
      ],
      instructors: [
        { name: "Sarah Johnson", title: "Camera & Lighting Specialist", initial: "S" },
        { name: "Mike Chen", title: "Audio & Post-Production", initial: "M" }
      ],
      campStats: [
        { label: "Total Students:", value: "24" },
        { label: "Projects Started:", value: "8" },
        { label: "Skills Workshops:", value: "12" },
        { label: "Days Remaining:", value: "12", highlight: true }
      ],
      posts: [
        {
          id: 1,
          type: 'video',
          title: 'Day 1: Camera Basics Workshop',
          content: 'Students learned the fundamentals of camera operation and composition.',
          author: 'Instructor Sarah',
          date: '2025-07-01T09:00:00',
          likes: 15,
          comments: 3,
          thumbnail: 'https://placehold.co/400x225'
        },
        {
          id: 2,
          type: 'photo',
          title: 'Behind the Scenes: Set Design',
          content: 'Amazing creativity from our campers designing their first TV set!',
          author: 'Instructor Mike',
          date: '2025-07-02T16:00:00',
          likes: 22,
          comments: 8,
          thumbnail: 'https://placehold.co/400x300'
        },
        {
          id: 3,
          type: 'blog',
          title: 'Week 1 Progress Report',
          content: 'This week our campers have made incredible progress learning the fundamentals of television production. From camera operation to lighting techniques, every student is developing their unique creative voice.',
          author: 'Camp Director',
          date: '2025-07-03T18:00:00',
          likes: 28,
          comments: 12
        }
      ],
      files: [
        {
          id: 1,
          name: 'Camp_Schedule_Week1.pdf',
          type: 'pdf',
          size: '2.3 MB',
          uploadDate: '2025-07-01'
        },
        {
          id: 2,
          name: 'Equipment_List.docx',
          type: 'doc',
          size: '1.1 MB',
          uploadDate: '2025-07-02'
        },
        {
          id: 3,
          name: 'Student_Projects_Guidelines.pdf',
          type: 'pdf',
          size: '3.2 MB',
          uploadDate: '2025-07-03'
        }
      ],
      campCalendar: [
        { start: "2025-07-01", end: "2025-07-05", theme: "Camera & Lighting", },
        { start: "2025-07-06", end: "2025-07-12", theme: "Editing & Post-Production" },
        { start: "2025-07-13", end: "2025-07-19", theme: "On-Air Presentation" }
      ],
      editingHomepage: false,
      editingCommunity: false,
      editingCalendar: false,
      // Extra pages state:
      recapShorts: {
        videos: [
          { title: "Week 1 Recap", youtube: "dQw4w9WgXcQ", thumb: "https://img.youtube.com/vi/dQw4w9WgXcQ/hqdefault.jpg" }
        ],
        desc: "Catch up with the best moments from each week of camp! More shorts coming soon."
      },
      studentVideos: [
        { title: "News Flash by Team Alpha", desc: "A creative newscast project by our campers!", youtube: "STUDENT_VIDEO_ID_1", thumb: "https://placehold.co/400x225" },
        { title: "Behind the Scenes by Team Beta", desc: "Documentary on camp life and teamwork.", youtube: "STUDENT_VIDEO_ID_2", thumb: "https://placehold.co/400x225" }
      ],
      studentGallery: [
        { url: "https://placehold.co/400x300", caption: "Team Alpha hard at work" },
        { url: "https://placehold.co/400x300", caption: "Fun with lighting" }
      ],
      countdown: {
        nextWeekStart: "2025-07-07T09:00:00",
        desc: "Get ready for the next chapter of your camp adventure!"
      },
      weekExpect: [
        { title: "Week 1: Camera & Lighting", desc: "Hands-on training with cameras, composition, lighting, and fundamentals of visual storytelling. Expect workshops, group activities, and your first recording projects!" },
        { title: "Week 2: Editing & Post-Production", desc: "Dive into video editing, sound design, and special effects. You'll learn advanced techniques and start shaping your raw footage into polished productions." },
        { title: "Week 3: On-Air Presentation & Live Production", desc: "Master live broadcasting, multi-camera setups, and on-screen talent development. Produce your own live show and refine your presentation skills!" }
      ]
    };

    // --- Load saved state from localStorage if available ---
    let saved = localStorage.getItem('ivtvCampState');
    if (saved) {
      try {
        Object.assign(state, JSON.parse(saved));
      } catch (e) {
        // If localStorage is corrupted, ignore and start fresh
      }
    }

    // --- setState now also persists to localStorage ---
    function setState(newValues) {
      Object.assign(state, newValues);
      try {
        localStorage.setItem('ivtvCampState', JSON.stringify(state));
      } catch (e) {
        // Ignore quota exceeded or private mode
      }
      renderApp();
    }

    // --- State Logic/Setters ---
    function handleAdminLogin() {
      if (state.adminPassword === 'IVTVRules123!') {
        setState({isAdmin: true, showAdminLogin: false, adminPassword: ''});
      } else {
        alert('Incorrect password');
      }
    }
    function handleAdminLogout() { setState({isAdmin: false, activeTab: 'dashboard'}); }
    function handleNewPost(form) {
      const postData = Object.fromEntries(new FormData(form));
      const newPost = {
        id: state.posts.length + 1,
        ...postData,
        date: new Date().toISOString(),
        likes: 0,
        comments: 0
      };
      setState({posts: [newPost, ...state.posts], showNewPostForm: false});
    }
    function handleEditPost(form) {
      const postData = Object.fromEntries(new FormData(form));
      setState({
        posts: state.posts.map(post => post.id == state.editingPost.id ? {...post, ...postData} : post),
        editingPost: null
      });
    }
    function handleDeletePost(postId) {
      if (confirm('Are you sure you want to delete this post?')) {
        setState({posts: state.posts.filter(post => post.id != postId)});
      }
    }
    function handleNewFile(form) {
      const fileData = Object.fromEntries(new FormData(form));
      const newFile = {
        id: state.files.length + 1,
        ...fileData,
        uploadDate: new Date().toISOString().split('T')[0]
      };
      setState({files: [newFile, ...state.files], showNewFileForm: false});
    }
    function handleDeleteFile(fileId) {
      if (confirm('Are you sure you want to delete this file?')) {
        setState({files: state.files.filter(file => file.id != fileId)});
      }
    }
    function expandPost(postId) {
      const post = state.posts.find(p => p.id == postId);
      setState({expandedPost: post});
    }
    function closeExpandedPost() { setState({expandedPost: null}); }

    function addInstructor() {
      state.instructors.push({ name: "", title: "", initial: "" });
      renderApp();
    }
    function removeInstructor(idx) {
      state.instructors.splice(idx, 1);
      renderApp();
    }
    function addCalendarWeek() {
      state.campCalendar.push({ start: "", end: "", theme: "" });
      renderApp();
    }
    function removeCalendarWeek(idx) {
      state.campCalendar.splice(idx, 1);
      renderApp();
    }

    function handleEditHomepage(form) {
      const formData = new FormData(form);
      const newHomepageHeroTitle = formData.get('homepageHeroTitle');
      const newHomepageHeroSubtitle = formData.get('homepageHeroSubtitle');
      setState({
        homepageHeroTitle: newHomepageHeroTitle,
        homepageHeroSubtitle: newHomepageHeroSubtitle,
        editingHomepage: false
      });
    }
    function handleEditRecapShorts(form) {
      const formData = new FormData(form);
      const newRecapShortsDesc = formData.get('recapShortsDesc');
      const newVideos = [];
      let i = 0;
      while (formData.has(`videoTitle${i}`)) {
        newVideos.push({
          title: formData.get(`videoTitle${i}`),
          youtube: formData.get(`videoYoutube${i}`),
          thumb: formData.get(`videoThumb${i}`)
        });
        i++;
      }
      setState({
        recapShorts: {
          ...state.recapShorts,
          desc: newRecapShortsDesc,
          videos: newVideos
        },
        editingRecapShorts: false
      });
    }
    function handleEditStudentVideos(form) {
      const formData = new FormData(form);
      const newVideos = [];
      let i = 0;
      while (formData.has(`studentVideoTitle${i}`)) {
        newVideos.push({
          title: formData.get(`studentVideoTitle${i}`),
          desc: formData.get(`studentVideoDesc${i}`),
          youtube: formData.get(`studentVideoYoutube${i}`),
          thumb: formData.get(`studentVideoThumb${i}`)
        });
        i++;
      }
      setState({
        studentVideos: newVideos,
        editingStudentVideos: false
      });
    }
    function handleEditStudentGallery(form) {
      const formData = new FormData(form);
      const newImages = [];
      let i = 0;
      while (formData.has(`galleryUrl${i}`)) {
        newImages.push({
          url: formData.get(`galleryUrl${i}`),
          caption: formData.get(`galleryCaption${i}`)
        });
        i++;
      }
      setState({
        studentGallery: newImages,
        editingStudentGallery: false
      });
    }
    function handleEditWeekExpect(form) {
      const formData = new FormData(form);
      const newWeeks = [];
      let i = 0;
      while (formData.has(`weekExpectTitle${i}`)) {
        newWeeks.push({
          title: formData.get(`weekExpectTitle${i}`),
          desc: formData.get(`weekExpectDesc${i}`)
        });
        i++;
      }
      const newCountdownNextWeekStart = formData.get('countdownNextWeekStart');
      const newCountdownDesc = formData.get('countdownDesc');

      setState({
        weekExpect: newWeeks,
        countdown: {
          nextWeekStart: newCountdownNextWeekStart,
          desc: newCountdownDesc
        },
        editingWeekExpect: false
      });
    }

    function addRecapShortVideo() {
      state.recapShorts.videos.push({ title: "", youtube: "", thumb: "" });
      renderApp();
    }
    function removeRecapShortVideo(idx) {
      state.recapShorts.videos.splice(idx, 1);
      renderApp();
    }

    function addStudentVideo() {
      state.studentVideos.push({ title: "", desc: "", youtube: "", thumb: "" });
      renderApp();
    }
    function removeStudentVideo(idx) {
      state.studentVideos.splice(idx, 1);
      renderApp();
    }

    function addStudentGalleryImage() {
      state.studentGallery.push({ url: "", caption: "" });
      renderApp();
    }
    function removeStudentGalleryImage(idx) {
      state.studentGallery.splice(idx, 1);
      renderApp();
    }
    function addWeekExpectItem() {
      state.weekExpect.push({ title: "", desc: "" });
      renderApp();
    }
    function removeWeekExpectItem(idx) {
      state.weekExpect.splice(idx, 1);
      renderApp();
    }

    // Dynamic homepage boxes
    function getHomepageBoxes() {
      const week = getCurrentCampWeek(state);
      let today = new Date();
      let daysLeft = 0;
      if (week) {
        const end = new Date(week.end);
        daysLeft = Math.max(0, Math.ceil((end - today) / (1000*60*60*24)) + 1);
      }
      const thisWeekBox = {
        title: week ? week.theme : "This Week",
        icon: "Video",
        text: week ? `Theme: ${week.theme}` : "No theme scheduled",
        bottomLabel: "Days Left:",
        bottomValue: week ? daysLeft : "N/A"
      };
      const lastPost = state.posts.length ? state.posts[0] : null;
      const lastUpdateBox = {
        title: "Recent Activity",
        icon: "Bell",
        text: `${state.posts.length} new posts from instructors`,
        bottomLabel: "Last update:",
        bottomValue: lastPost ? getTimeAgo(lastPost.date) : "No posts"
      };
      const filesBox = state.homepageBoxes[2];
      return [thisWeekBox, lastUpdateBox, filesBox];
    }

    // ================= COMPONENTS ==================
    function Navigation() {
      const activeClass = "bg-red-600 text-white";
      const inactiveClass = "text-red-100 hover:bg-red-700 hover:bg-opacity-75";
      const linkClass = "flex items-center px-4 py-2 rounded-md text-sm font-medium";

      return `
        <nav class="bg-red-800 shadow-lg relative z-10">
          <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
              <a href="#" onclick="setState({activeTab:'dashboard'})" class="text-white text-2xl font-bold flex items-center">
                <img src="https://placehold.co/40x40/white/red" alt="IVTV Logo" class="mr-2 rounded-full">
                IVTV Camp 2025
              </a>

              <div class="hidden md:flex space-x-4">
                <a href="#" onclick="setState({activeTab:'dashboard'})" class="${linkClass} ${state.activeTab === 'dashboard' ? activeClass : inactiveClass}">
                  ${SVG.Bell}
                  <span class="ml-2">Dashboard</span>
                </a>
                <a href="#" onclick="setState({activeTab:'recapShorts'})" class="${linkClass} ${state.activeTab === 'recapShorts' ? activeClass : inactiveClass}">
                  ${SVG.Video}
                  <span class="ml-2">Recap Shorts</span>
                </a>
                <a href="#" onclick="setState({activeTab:'studentVideos'})" class="${linkClass} ${state.activeTab === 'studentVideos' ? activeClass : inactiveClass}">
                  ${SVG.Camera}
                  <span class="ml-2">Student Videos</span>
                </a>
                <a href="#" onclick="setState({activeTab:'studentGallery'})" class="${linkClass} ${state.activeTab === 'studentGallery' ? activeClass : inactiveClass}">
                  ${SVG.FileText}
                  <span class="ml-2">Gallery</span>
                </a>
                <a href="#" onclick="setState({activeTab:'weekByWeek'})" class="${linkClass} ${state.activeTab === 'weekByWeek' ? activeClass : inactiveClass}">
                  ${SVG.Calendar}
                  <span class="ml-2">Week-by-Week</span>
                </a>
                ${state.isAdmin ? `
                  <a href="#" onclick="setState({activeTab:'admin'})" class="${linkClass} ${state.activeTab === 'admin' ? activeClass : inactiveClass}">
                    ${SVG.Users}
                    <span class="ml-2">Admin</span>
                  </a>
                  <button onclick="handleAdminLogout()" class="ml-4 bg-white text-red-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-100">Logout</button>
                ` : `
                  <button onclick="setState({showAdminLogin:true})" class="ml-4 bg-white text-red-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-100">Admin Login</button>
                `}
              </div>

              <div class="md:hidden flex items-center">
                <button onclick="setState({mobileMenuOpen:!state.mobileMenuOpen})" class="text-white focus:outline-none">
                  ${state.mobileMenuOpen ? SVG.X : SVG.Menu}
                </button>
              </div>
            </div>
          </div>

          ${state.mobileMenuOpen ? `
            <div class="md:hidden">
              <a href="#" onclick="setState({activeTab:'dashboard', mobileMenuOpen:false})" class="${linkClass} ${state.activeTab === 'dashboard' ? activeClass : inactiveClass} block">
                ${SVG.Bell}<span class="ml-2">Dashboard</span>
              </a>
              <a href="#" onclick="setState({activeTab:'recapShorts', mobileMenuOpen:false})" class="${linkClass} ${state.activeTab === 'recapShorts' ? activeClass : inactiveClass} block">
                ${SVG.Video}<span class="ml-2">Recap Shorts</span>
              </a>
              <a href="#" onclick="setState({activeTab:'studentVideos', mobileMenuOpen:false})" class="${linkClass} ${state.activeTab === 'studentVideos' ? activeClass : inactiveClass} block">
                ${SVG.Camera}<span class="ml-2">Student Videos</span>
              </a>
              <a href="#" onclick="setState({activeTab:'studentGallery', mobileMenuOpen:false})" class="${linkClass} ${state.activeTab === 'studentGallery' ? activeClass : inactiveClass} block">
                ${SVG.FileText}<span class="ml-2">Gallery</span>
              </a>
              <a href="#" onclick="setState({activeTab:'weekByWeek', mobileMenuOpen:false})" class="${linkClass} ${state.activeTab === 'weekByWeek' ? activeClass : inactiveClass} block">
                ${SVG.Calendar}<span class="ml-2">Week-by-Week</span>
              </a>
              ${state.isAdmin ? `
                <a href="#" onclick="setState({activeTab:'admin', mobileMenuOpen:false})" class="${linkClass} ${state.activeTab === 'admin' ? activeClass : inactiveClass} block">
                  ${SVG.Users}<span class="ml-2">Admin</span>
                </a>
                <button onclick="handleAdminLogout(); setState({mobileMenuOpen:false})" class="block w-full text-left bg-white text-red-800 px-4 py-2 text-sm font-medium hover:bg-gray-100">Logout</button>
              ` : `
                <button onclick="setState({showAdminLogin:true, mobileMenuOpen:false})" class="block w-full text-left bg-white text-red-800 px-4 py-2 text-sm font-medium hover:bg-gray-100">Admin Login</button>
              `}
            </div>
          ` : ''}
        </nav>
      `;
    }

    function AdminLoginModal() {
      if (!state.showAdminLogin) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white p-6 rounded-lg shadow-xl">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Admin Login</h3>
            <input type="password" class="w-full p-2 border border-gray-300 rounded mb-4" placeholder="Password" oninput="setState({adminPassword:event.target.value})"/>
            <div class="flex justify-end space-x-2">
              <button onclick="handleAdminLogin()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Login</button>
              <button onclick="setState({showAdminLogin:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </div>
        </div>
      `;
    }

    function NewPostModal() {
      if (!state.showNewPostForm) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleNewPost(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Create New Post</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Title</label>
              <input type="text" name="title" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Content</label>
              <textarea name="content" class="mt-1 p-2 w-full border rounded-md" rows="4" required></textarea>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Author</label>
              <input type="text" name="author" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Type</label>
              <select name="type" class="mt-1 p-2 w-full border rounded-md">
                <option value="blog">Blog</option>
                <option value="video">Video</option>
                <option value="photo">Photo</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Thumbnail URL (optional)</label>
              <input type="url" name="thumbnail" class="mt-1 p-2 w-full border rounded-md"/>
            </div>
            <div class="flex justify-end space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Publish Post</button>
              <button type="button" onclick="setState({showNewPostForm:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function EditPostModal() {
      if (!state.editingPost) return '';
      const post = state.editingPost;
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleEditPost(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Post</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Title</label>
              <input type="text" name="title" value="${post.title.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Content</label>
              <textarea name="content" class="mt-1 p-2 w-full border rounded-md" rows="4" required>${post.content}</textarea>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Author</label>
              <input type="text" name="author" value="${post.author.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Type</label>
              <select name="type" class="mt-1 p-2 w-full border rounded-md">
                <option value="blog" ${post.type === 'blog' ? 'selected' : ''}>Blog</option>
                <option value="video" ${post.type === 'video' ? 'selected' : ''}>Video</option>
                <option value="photo" ${post.type === 'photo' ? 'selected' : ''}>Photo</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Thumbnail URL (optional)</label>
              <input type="url" name="thumbnail" value="${post.thumbnail || ''}" class="mt-1 p-2 w-full border rounded-md"/>
            </div>
            <div class="flex justify-end space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save Changes</button>
              <button type="button" onclick="setState({editingPost:null})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function ExpandedPostModal() {
      if (!state.expandedPost) return '';
      const post = state.expandedPost;
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto relative">
            <button onclick="closeExpandedPost()" class="absolute top-3 right-3 text-gray-600 hover:text-gray-900">
              ${SVG.X}
            </button>
            ${post.thumbnail && post.type !== 'blog' ? `<img src="${post.thumbnail}" alt="${post.title}" class="w-full h-64 object-cover rounded-t-lg"/>` : ''}
            <div class="p-6">
              <h3 class="text-2xl font-bold text-gray-900 mb-2">${post.title}</h3>
              <p class="text-sm text-gray-600 mb-4">By ${post.author} on ${new Date(post.date).toLocaleDateString()}</p>
              <p class="text-gray-700 mb-4">${post.content}</p>
              <div class="flex items-center text-gray-500 text-sm">
                <span class="mr-4 flex items-center">${SVG.Heart} ${post.likes} Likes</span>
                <span class="flex items-center">${SVG.MessageCircle} ${post.comments} Comments</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function NewFileModal() {
      if (!state.showNewFileForm) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleNewFile(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Upload New File</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">File Name</label>
              <input type="text" name="name" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">File Type (e.g., pdf, doc, jpg)</label>
              <input type="text" name="type" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">File Size (e.g., 2.3 MB)</label>
              <input type="text" name="size" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="flex justify-end space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Upload File</button>
              <button type="button" onclick="setState({showNewFileForm:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function AdminDashboard() {
      return `
        <section class="mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Admin Dashboard</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Homepage Content</h3>
              <p class="text-gray-600 mb-4">Edit the main hero section title and subtitle.</p>
              <button onclick="setState({editingHomepage:true})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Edit Homepage</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Community & Instructors</h3>
              <p class="text-gray-600 mb-4">Manage instructor profiles and camp statistics.</p>
              <button onclick="setState({editingCommunity:true})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Edit Community</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Camp Calendar</h3>
              <p class="text-gray-600 mb-4">Adjust week start/end dates and themes.</p>
              <button onclick="setState({editingCalendar:true})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Edit Calendar</button>
            </div>
             <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Recap Shorts</h3>
              <p class="text-gray-600 mb-4">Manage the short highlight videos and description.</p>
              <button onclick="setState({editingRecapShorts:true})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Edit Recap Shorts</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Student Videos</h3>
              <p class="text-gray-600 mb-4">Add, edit, or remove student video projects.</p>
              <button onclick="setState({editingStudentVideos:true})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Edit Student Videos</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Student Gallery</h3>
              <p class="text-gray-600 mb-4">Update and manage student project image gallery.</p>
              <button onclick="setState({editingStudentGallery:true})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Edit Student Gallery</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Week-by-Week Content</h3>
              <p class="text-gray-600 mb-4">Modify weekly expectations and countdown details.</p>
              <button onclick="setState({editingWeekExpect:true})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Edit Week Content</button>
            </div>
          </div>
        </section>

        <section class="mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Content Management</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Posts</h3>
              <p class="text-gray-600 mb-4">Add or manage community posts.</p>
              <button onclick="setState({showNewPostForm:true})" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 mr-2">New Post</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3">Files</h3>
              <p class="text-gray-600 mb-4">Upload new camp files.</p>
              <button onclick="setState({showNewFileForm:true})" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 mr-2">New File</button>
            </div>
          </div>
        </section>

        <section>
          <h2 class="text-2xl font-bold text-gray-800 mb-4">All Posts</h2>
          <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <ul class="divide-y divide-gray-200">
              ${state.posts.map(post => `
                <li class="p-4 flex justify-between items-center hover:bg-gray-50">
                  <div>
                    <h4 class="text-lg font-semibold text-gray-800">${post.title}</h4>
                    <p class="text-sm text-gray-600">by ${post.author} - ${new Date(post.date).toLocaleDateString()}</p>
                  </div>
                  <div class="flex space-x-2">
                    <button onclick="setState({editingPost: ${post.id}})" class="text-blue-600 hover:text-blue-800 text-sm">Edit</button>
                    <button onclick="handleDeletePost(${post.id})" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                  </div>
                </li>
              `).join('')}
            </ul>
          </div>
        </section>

        <section class="mt-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">All Files</h2>
          <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <ul class="divide-y divide-gray-200">
              ${state.files.map(file => `
                <li class="p-4 flex justify-between items-center hover:bg-gray-50">
                  <div>
                    <h4 class="text-lg font-semibold text-gray-800">${file.name}</h4>
                    <p class="text-sm text-gray-600">Type: ${file.type.toUpperCase()} | Size: ${file.size} | Uploaded: ${file.uploadDate}</p>
                  </div>
                  <button onclick="handleDeleteFile(${file.id})" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                </li>
              `).join('')}
            </ul>
          </div>
        </section>
      `;
    }

    function EditHomepageModal() {
      if (!state.editingHomepage) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleEditHomepage(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Homepage Hero Section</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Hero Title</label>
              <input type="text" name="homepageHeroTitle" value="${state.homepageHeroTitle.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Hero Subtitle</label>
              <input type="text" name="homepageHeroSubtitle" value="${state.homepageHeroSubtitle.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="flex justify-end space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
              <button type="button" onclick="setState({editingHomepage:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function EditCommunityModal() {
      return `
      <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <form id="edit-community-form" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Community</h3>
          <div class="mb-6">
            <label class="block text-sm font-semibold mb-2">Instructors</label>
            ${state.instructors.map((inst, idx) => `
              <div class="mb-4 border rounded-lg p-3">
                <label class="text-xs font-bold block mb-1">Instructor ${idx+1}</label>
                <div class="flex gap-2">
                  <input type="text" name="instInitial${idx}" value="${inst.initial.replace(/"/g,'&quot;')}" class="w-12 mr-2 p-1 border border-gray-200 rounded" placeholder="Initial" maxlength="1"/>
                  <input type="text" name="instName${idx}" value="${inst.name.replace(/"/g,'&quot;')}" class="w-1/3 mr-2 p-1 border border-gray-200 rounded" placeholder="Name"/>
                  <input type="text" name="instTitle${idx}" value="${inst.title.replace(/"/g,'&quot;')}" class="w-1/2 p-1 border border-gray-200 rounded" placeholder="Title"/>
                </div>
                <button type="button" onclick="removeInstructor(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
              </div>
            `).join('')}
            <button type="button" onclick="addInstructor()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Instructor</button>
          </div>
          <div class="mb-6">
            <label class="block text-sm font-semibold mb-2">Camp Stats</label>
            ${state.campStats.map((stat, idx) => `
              <div class="mb-2 flex items-center">
                <input type="text" name="statLabel${idx}" value="${stat.label.replace(/"/g,'&quot;')}" class="w-1/2 mr-2 p-1 border border-gray-200 rounded" placeholder="Label"/>
                <input type="text" name="statValue${idx}" value="${stat.value.replace(/"/g,'&quot;')}" class="w-1/4 mr-2 p-1 border border-gray-200 rounded" placeholder="Value"/>
                <input type="checkbox" name="statHighlight${idx}" ${stat.highlight ? 'checked' : ''} class="mr-1"/> Highlight
              </div>
            `).join('')}
          </div>
          <div class="flex space-x-2">
            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
            <button type="button" onclick="setState({editingCommunity:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
          </div>
        </form>
      </div>
      `;
    }

    function EditCalendarModal() {
      return `
      <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <form onsubmit="event.preventDefault(); handleEditWeekExpect(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Camp Calendar</h3>
          <div class="mb-4">
            ${state.campCalendar.map((week, idx) => `
              <div class="mb-4 border rounded-lg p-3">
                <label class="text-xs font-bold block mb-1">Week ${idx+1}</label>
                <div class="flex gap-2">
                  <input type="date" name="start${idx}" value="${week.start}" class="p-1 border border-gray-200 rounded" required/>
                  <span class="mt-2">to</span>
                  <input type="date" name="end${idx}" value="${week.end}" class="p-1 border border-gray-200 rounded" required/>
                </div>
                <input type="text" name="theme${idx}" value="${week.theme.replace(/"/g,'&quot;')}" class="w-full p-1 mt-2 border border-gray-200 rounded" placeholder="Theme/Title"/>
                <button type="button" onclick="removeCalendarWeek(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
              </div>
            `).join('')}
          </div>
          <button type="button" onclick="addCalendarWeek()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Week</button>
          <div class="flex space-x-2">
            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
            <button type="button" onclick="setState({editingCalendar:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
          </div>
        </form>
      </div>
      `;
    }

    function EditRecapShortsModal() {
      if (!state.editingRecapShorts) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleEditRecapShorts(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Recap Shorts</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Description</label>
              <textarea name="recapShortsDesc" class="mt-1 p-2 w-full border rounded-md" rows="3">${state.recapShorts.desc}</textarea>
            </div>
            <div class="mb-6">
              <label class="block text-sm font-semibold mb-2">Videos</label>
              ${state.recapShorts.videos.map((video, idx) => `
                <div class="mb-4 border rounded-lg p-3">
                  <label class="text-xs font-bold block mb-1">Video ${idx+1}</label>
                  <input type="text" name="videoTitle${idx}" value="${video.title.replace(/"/g,'&quot;')}" class="w-full p-1 border border-gray-200 rounded mb-2" placeholder="Title"/>
                  <input type="text" name="videoYoutube${idx}" value="${video.youtube}" class="w-full p-1 border border-gray-200 rounded mb-2" placeholder="YouTube Video ID"/>
                  <input type="url" name="videoThumb${idx}" value="${video.thumb}" class="w-full p-1 border border-gray-200 rounded" placeholder="Thumbnail URL"/>
                  <button type="button" onclick="removeRecapShortVideo(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
                </div>
              `).join('')}
              <button type="button" onclick="addRecapShortVideo()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Video</button>
            </div>
            <div class="flex space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
              <button type="button" onclick="setState({editingRecapShorts:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function EditStudentVideosModal() {
      if (!state.editingStudentVideos) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleEditStudentVideos(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Student Videos</h3>
            <div class="mb-6">
              <label class="block text-sm font-semibold mb-2">Videos</label>
              ${state.studentVideos.map((video, idx) => `
                <div class="mb-4 border rounded-lg p-3">
                  <label class="text-xs font-bold block mb-1">Video ${idx+1}</label>
                  <input type="text" name="studentVideoTitle${idx}" value="${video.title.replace(/"/g,'&quot;')}" class="w-full p-1 border border-gray-200 rounded mb-2" placeholder="Title"/>
                  <textarea name="studentVideoDesc${idx}" class="w-full p-1 border border-gray-200 rounded mb-2" rows="2" placeholder="Description">${video.desc}</textarea>
                  <input type="text" name="studentVideoYoutube${idx}" value="${video.youtube}" class="w-full p-1 border border-gray-200 rounded mb-2" placeholder="YouTube Video ID"/>
                  <input type="url" name="studentVideoThumb${idx}" value="${video.thumb}" class="w-full p-1 border border-gray-200 rounded" placeholder="Thumbnail URL"/>
                  <button type="button" onclick="removeStudentVideo(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
                </div>
              `).join('')}
              <button type="button" onclick="addStudentVideo()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Video</button>
            </div>
            <div class="flex space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
              <button type="button" onclick="setState({editingStudentVideos:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function EditStudentGalleryModal() {
      if (!state.editingStudentGallery) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleEditStudentGallery(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Student Gallery</h3>
            <div class="mb-6">
              <label class="block text-sm font-semibold mb-2">Images</label>
              ${state.studentGallery.map((image, idx) => `
                <div class="mb-4 border rounded-lg p-3">
                  <label class="text-xs font-bold block mb-1">Image ${idx+1}</label>
                  <input type="url" name="galleryUrl${idx}" value="${image.url}" class="w-full p-1 border border-gray-200 rounded mb-2" placeholder="Image URL"/>
                  <input type="text" name="galleryCaption${idx}" value="${image.caption.replace(/"/g,'&quot;')}" class="w-full p-1 border border-gray-200 rounded" placeholder="Caption"/>
                  <button type="button" onclick="removeStudentGalleryImage(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
                </div>
              `).join('')}
              <button type="button" onclick="addStudentGalleryImage()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Image</button>
            </div>
            <div class="flex space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
              <button type="button" onclick="setState({editingStudentGallery:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function EditWeekExpectModal() {
      if (!state.editingWeekExpect) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleEditWeekExpect(this)" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Week-by-Week Content</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Next Week Countdown Start Date/Time</label>
              <input type="datetime-local" name="countdownNextWeekStart" value="${state.countdown.nextWeekStart.substring(0,16)}" class="mt-1 p-2 w-full border rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Countdown Description</label>
              <textarea name="countdownDesc" class="mt-1 p-2 w-full border rounded-md" rows="2">${state.countdown.desc}</textarea>
            </div>
            <div class="mb-6">
              <label class="block text-sm font-semibold mb-2">Weekly Expectations</label>
              ${state.weekExpect.map((week, idx) => `
                <div class="mb-4 border rounded-lg p-3">
                  <label class="text-xs font-bold block mb-1">Week ${idx+1}</label>
                  <input type="text" name="weekExpectTitle${idx}" value="${week.title.replace(/"/g,'&quot;')}" class="w-full p-1 border border-gray-200 rounded mb-2" placeholder="Week Title"/>
                  <textarea name="weekExpectDesc${idx}" class="w-full p-1 border border-gray-200 rounded" rows="3" placeholder="Description">${week.desc}</textarea>
                  <button type="button" onclick="removeWeekExpectItem(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
                </div>
              `).join('')}
              <button type="button" onclick="addWeekExpectItem()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Week</button>
            </div>
            <div class="flex space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
              <button type="button" onclick="setState({editingWeekExpect:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function LightboxModal() {
      if (!state.lightbox) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4" onclick="setState({lightbox:null})">
          <div class="relative max-w-full max-h-full" onclick="event.stopPropagation()">
            <img src="${state.lightbox.url}" alt="${state.lightbox.caption}" class="max-w-full max-h-[90vh] object-contain rounded-lg shadow-xl"/>
            ${state.lightbox.caption ? `<p class="text-white text-center mt-2">${state.lightbox.caption}</p>` : ''}
            <button onclick="setState({lightbox:null})" class="absolute top-2 right-2 bg-black bg-opacity-50 text-white rounded-full p-2">
              ${SVG.X}
            </button>
          </div>
        </div>
      `;
    }

    function HomepageSection() {
      const homepageBoxes = getHomepageBoxes();
      const currentWeek = getCurrentCampWeek(state);
      return `
        <section class="text-center py-16 bg-gradient-to-r from-red-700 to-red-900 text-white rounded-lg shadow-xl mb-8">
          <h1 class="text-5xl font-extrabold mb-4">${state.homepageHeroTitle}</h1>
          <p class="text-xl font-light opacity-90">${state.homepageHeroSubtitle}</p>
        </section>

        <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          ${homepageBoxes.map(box => `
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
              <div class="text-red-600 mb-3 flex justify-center items-center">
                ${SVG[box.icon] || ''}
              </div>
              <h3 class="text-xl font-semibold text-gray-800 mb-2">${box.title || 'Upcoming Event'}</h3>
              <p class="text-gray-600 text-sm mb-4">${box.text || 'Details coming soon.'}</p>
              <div class="text-gray-700 font-bold">
                ${box.bottomLabel || ''} <span id="${box.bottomLabel && box.bottomLabel.includes('Last update:') ? 'dynamic-homepage-box1' : ''}">${box.bottomValue instanceof Function ? box.bottomValue() : (box.bottomValue || 'N/A')}</span>
              </div>
            </div>
          `).join('')}
        </section>

        <section class="mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Community Feed</h2>
          <div class="flex justify-end mb-4">
            ${state.isAdmin ? `<button onclick="setState({showNewPostForm:true})" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center">${SVG.Upload} <span class="ml-2">New Post</span></button>` : ''}
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${state.posts.map(post => `
              <div class="bg-white rounded-lg shadow-md overflow-hidden">
                ${post.thumbnail ? `<img src="${post.thumbnail}" alt="${post.title}" class="w-full h-48 object-cover"/>` : ''}
                <div class="p-4">
                  <h3 class="text-lg font-semibold text-gray-800 mb-2">${post.title}</h3>
                  <p class="text-gray-600 text-sm mb-3 line-clamp-3">${post.content}</p>
                  <div class="flex justify-between items-center text-xs text-gray-500 mb-3">
                    <span>By ${post.author}</span>
                    <span>${getTimeAgo(post.date)}</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <button onclick="expandPost(${post.id})" class="text-red-600 hover:underline text-sm">Read More</button>
                    <div class="flex items-center space-x-3">
                      <span class="flex items-center">${SVG.Heart} ${post.likes}</span>
                      <span class="flex items-center">${SVG.MessageCircle} ${post.comments}</span>
                    </div>
                  </div>
                  ${state.isAdmin ? `
                    <div class="mt-3 flex space-x-2">
                      <button onclick="setState({editingPost:${post.id}})" class="text-blue-600 hover:underline text-xs">Edit</button>
                      <button onclick="handleDeletePost(${post.id})" class="text-red-600 hover:underline text-xs">Delete</button>
                    </div>
                  ` : ''}
                </div>
              </div>
            `).join('')}
          </div>
        </section>

        <section class="mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Files & Resources</h2>
          <div class="flex justify-end mb-4">
            ${state.isAdmin ? `<button onclick="setState({showNewFileForm:true})" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center">${SVG.Upload} <span class="ml-2">Upload File</span></button>` : ''}
          </div>
          <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <ul class="divide-y divide-gray-200">
              ${state.files.map(file => `
                <li class="p-4 flex items-center justify-between hover:bg-gray-50">
                  <div class="flex items-center">
                    ${SVG.FileText}
                    <div class="ml-3">
                      <p class="text-gray-800 font-semibold">${file.name}</p>
                      <p class="text-sm text-gray-600">${file.size} - ${file.uploadDate}</p>
                    </div>
                  </div>
                  <div class="flex space-x-3">
                    <a href="#" class="text-blue-600 hover:text-blue-800" download>${SVG.Download}</a>
                    ${state.isAdmin ? `<button onclick="handleDeleteFile(${file.id})" class="text-red-600 hover:text-red-800">${SVG.X}</button>` : ''}
                  </div>
                </li>
              `).join('')}
            </ul>
          </div>
        </section>

        <section class="mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Our Instructors</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            ${state.instructors.map(instructor => `
              <div class="bg-white rounded-lg shadow-md p-6 flex items-center space-x-4">
                <div class="w-16 h-16 bg-red-200 rounded-full flex items-center justify-center text-red-800 text-xl font-bold">
                  ${instructor.initial}
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-gray-800">${instructor.name}</h3>
                  <p class="text-gray-600 text-sm">${instructor.title}</p>
                </div>
              </div>
            `).join('')}
          </div>
        </section>

        <section>
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Camp Statistics</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            ${state.campStats.map(stat => `
              <div class="bg-white rounded-lg shadow-md p-5 text-center">
                <p class="text-gray-600 text-sm">${stat.label}</p>
                <p class="text-3xl font-bold ${stat.highlight ? 'text-red-600' : 'text-gray-800'}">${stat.value}</p>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function CountdownSection() {
      return `
        <section class="text-center py-8 bg-red-600 text-white rounded-lg shadow-md mb-8">
          <h2 class="text-3xl font-bold mb-2">Next Week Starts In:</h2>
          <div id="countdown-timer" class="text-5xl font-extrabold tracking-wide mb-2"></div>
          <p class="text-lg opacity-90">${state.countdown.desc}</p>
        </section>
      `;
    }

    function RecapShortsPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Camp Recap Shorts</h2>
          <p class="text-gray-600 mb-6">${state.recapShorts.desc}</p>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${state.recapShorts.videos.map(video => `
              <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="relative pb-[56.25%] h-0">
                  <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${video.youtube}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="p-4">
                  <h3 class="text-lg font-semibold text-gray-800">${video.title}</h3>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function StudentVideosPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Student Showcase Videos</h2>
          <p class="text-gray-600 mb-6">Explore creative video projects made by our talented campers!</p>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${state.studentVideos.map(video => `
              <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="relative pb-[56.25%] h-0">
                  <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${video.youtube}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="p-4">
                  <h3 class="text-lg font-semibold text-gray-800 mb-1">${video.title}</h3>
                  <p class="text-gray-600 text-sm">${video.desc}</p>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function StudentGalleryPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Student Project Gallery</h2>
          <p class="text-gray-600 mb-6">A visual collection of moments and masterpieces from camp!</p>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            ${state.studentGallery.map(image => `
              <div class="bg-white rounded-lg shadow-md overflow-hidden cursor-pointer" onclick="setState({lightbox: {url: '${image.url}', caption: '${image.caption.replace(/'/g, "\\'")}'}})">
                <img src="${image.url}" alt="${image.caption}" class="w-full h-48 object-cover transform hover:scale-105 transition duration-300"/>
                ${image.caption ? `<div class="p-3 text-sm text-gray-700">${image.caption}</div>` : ''}
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function WeekByWeekPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Week-by-Week Breakdown</h2>
          <p class="text-gray-600 mb-6">Detailed information about what to expect each week of camp, including themes, key activities, and learning objectives.</p>
          <div class="space-y-6">
            ${state.weekExpect.map((week, idx) => `
              <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-semibold text-red-700 mb-2">${week.title}</h3>
                <p class="text-gray-700">${week.desc}</p>
              </div>
            `).join('')}
          </div>
        </section>

        <section class="mt-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Camp Calendar Overview</h2>
          <div class="bg-white rounded-lg shadow-md p-6">
            ${state.campCalendar.map((week, idx) => `
              <div class="mb-4 pb-4 ${idx < state.campCalendar.length - 1 ? 'border-b border-gray-200' : ''}">
                <p class="text-lg font-semibold text-gray-800">Week ${idx + 1}: ${week.theme}</p>
                <p class="text-gray-600 text-sm">${new Date(week.start).toLocaleDateString()} - ${new Date(week.end).toLocaleDateString()}</p>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    // =================== MAIN RENDER FUNCTION ===================
    window.renderApp = function() {
      const container = document.getElementById('app');
      container.innerHTML = `
        ${Navigation()}
        <main class="max-w-6xl mx-auto px-4 py-8">
          ${
            state.activeTab === 'dashboard' ? HomepageSection() :
            state.activeTab === 'recapShorts' ? RecapShortsPage() :
            state.activeTab === 'studentVideos' ? StudentVideosPage() :
            state.activeTab === 'studentGallery' ? StudentGalleryPage() :
            state.activeTab === 'weekByWeek' ? WeekByWeekPage() :
            state.activeTab === 'admin' ? AdminDashboard() :
            `<div class="text-center text-gray-500 mt-12">Page not found.</div>`
          }
        </main>
        ${AdminLoginModal()}
        ${NewPostModal()}
        ${EditPostModal()}
        ${ExpandedPostModal()}
        ${NewFileModal()}
        ${state.editingHomepage ? EditHomepageModal() : ''}
        ${state.editingCommunity ? EditCommunityModal() : ''}
        ${state.editingCalendar ? EditCalendarModal() : ''}
        ${state.editingRecapShorts ? EditRecapShortsModal() : ''}
        ${state.editingStudentVideos ? EditStudentVideosModal() : ''}
        ${state.editingStudentGallery ? EditStudentGalleryModal() : ''}
        ${state.editingWeekExpect ? EditWeekExpectModal() : ''}
        ${state.lightbox ? LightboxModal() : ''}
      `;

      // Specific DOM updates for homepage timer, etc.
      if (state.activeTab === "dashboard") {
        if (window.homepageTimer) clearInterval(window.homepageTimer);
        window.homepageTimer = setInterval(() => {
          const box1 = document.getElementById("dynamic-homepage-box1");
          const lastPost = state.posts.length ? state.posts[0] : null;
          if (box1 && lastPost) box1.textContent = getTimeAgo(lastPost.date);
        }, 1000);
      } else {
        if (window.homepageTimer) {
          clearInterval(window.homepageTimer);
          window.homepageTimer = null;
        }
      }

      // Countdown timer for weekByWeek (if on that page, or dashboard if countdown section is always present)
      if (state.activeTab === 'weekByWeek' || state.activeTab === 'dashboard') { // Assuming countdown is shown on dashboard too, if not, adjust logic
        const updateCountdown = () => {
          const now = new Date();
          const target = new Date(state.countdown.nextWeekStart);
          let diff = (target - now) / 1000;
          if (diff < 0) diff = 0;
          const days = Math.floor(diff / (3600*24));
          const hours = Math.floor((diff % (3600*24)) / 3600);
          const minutes = Math.floor((diff % 3600) / 60);
          const seconds = Math.floor(diff % 60);
          const e = document.getElementById('countdown-timer');
          if (e) e.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        };
        // Clear any existing interval to prevent multiple timers
        if (window.countdownInterval) clearInterval(window.countdownInterval);
        window.countdownInterval = setInterval(updateCountdown, 1000);
        updateCountdown(); // Initial call to display immediately
      } else {
        if (window.countdownInterval) {
          clearInterval(window.countdownInterval);
          window.countdownInterval = null;
        }
      }

      // Modal close on ESC for expanded post
      if (state.expandedPost) {
        document.addEventListener('keydown', onKeyDownExpandModal);
      } else {
        document.removeEventListener('keydown', onKeyDownExpandModal);
      }
    }
    function onKeyDownExpandModal(e) {
      if (e.key === "Escape") closeExpandedPost();
    }
    // Expose functions for global onclick
    window.setState = setState;
    window.handleAdminLogin = handleAdminLogin;
    window.handleAdminLogout = handleAdminLogout;
    window.handleDeletePost = handleDeletePost;
    window.handleDeleteFile = handleDeleteFile;
    window.expandPost = expandPost;
    window.closeExpandedPost = closeExpandedPost;
    window.addInstructor = addInstructor;
    window.removeInstructor = removeInstructor;
    window.addCalendarWeek = addCalendarWeek;
    window.removeCalendarWeek = removeCalendarWeek;
    window.handleEditHomepage = handleEditHomepage;
    window.handleEditRecapShorts = handleEditRecapShorts;
    window.addRecapShortVideo = addRecapShortVideo;
    window.removeRecapShortVideo = removeRecapShortVideo;
    window.handleEditStudentVideos = handleEditStudentVideos;
    window.addStudentVideo = addStudentVideo;
    window.removeStudentVideo = removeStudentVideo;
    window.handleEditStudentGallery = handleEditStudentGallery;
    window.addStudentGalleryImage = addStudentGalleryImage;
    window.removeStudentGalleryImage = removeStudentGalleryImage;
    window.handleEditWeekExpect = handleEditWeekExpect;
    window.addWeekExpectItem = addWeekExpectItem;
    window.removeWeekExpectItem = removeWeekExpectItem;


    // Initial render
    renderApp();
  </script>
</body>
</html>
