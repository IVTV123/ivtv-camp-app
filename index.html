<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IVTV Summer Camp 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50">
  <div id="app"></div>
  <div id="edit-modal-root"></div>
  <div id="lightbox-root"></div>
  <script>
    // ================= ICONS & HELPERS ==================
    const SVG = {
      Calendar: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>`,
      Camera: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="2" y="7" width="20" height="15" rx="2"/><circle cx="12" cy="14.5" r="3.5"/><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
      FileText: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 22h16V2H8l-4 4v16z"/><path d="M14 2v6h6"/></svg>`,
      Users: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="9" cy="7" r="4"/><path d="M17 11c0-2.21-1.79-4-4-4"/><path d="M6 21v-2c0-2.21 3.58-4 8-4s8 1.79 8 4v2"/></svg>`,
      Video: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="7" width="15" height="10" rx="2"/><polygon points="16 7 22 12 16 17 16 7"/></svg>`,
      Bell: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M18 8a6 6 0 1 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>`,
      Upload: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>`,
      Play: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>`,
      Download: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>`,
      MessageCircle: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M21 11.5A8.38 8.38 0 0 1 3.6 18.3L2 22l3.7-1.6A8.5 8.5 0 1 1 21 11.5z"/></svg>`,
      Heart: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0l-.9.9-.9-.9a5.5 5.5 0 0 0-7.8 7.8l.9.9 7.8 7.8 7.8-7.8.9-.9a5.5 5.5 0 0 0 0-7.8z"/></svg>`,
      Share2: `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>`,
      Menu: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>`,
      X: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
      CameraLarge: `<svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="2" y="7" width="20" height="15" rx="2"/><circle cx="12" cy="14.5" r="3.5"/><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
      VideoLarge: `<svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="7" width="15" height="10" rx="2"/><polygon points="16 7 22 12 16 17 16 7"/></svg>`,
      FileTextLarge: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 22h16V2H8l-4 4v16z"/><path d="M14 2v6h6"/></svg>`,
      VideoRed: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="7" width="15" height="10" rx="2"/><polygon points="16 7 22 12 16 17 16 7"/></svg>`,
      CameraRed: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="2" y="7" width="20" height="15" rx="2"/><circle cx="12" cy="14.5" r="3.5"/><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`
    };

    function getTimeAgo(dateStr) {
      const now = new Date();
      const then = new Date(dateStr);
      const sec = Math.floor((now - then) / 1000);
      if (sec < 60) return sec === 1 ? "1 second ago" : sec + " seconds ago";
      const min = Math.floor(sec / 60);
      if (min < 60) return min === 1 ? "1 minute ago" : min + " minutes ago";
      const hr = Math.floor(min / 60);
      if (hr < 24) return hr === 1 ? "1 hour ago" : hr + " hours ago";
      const days = Math.floor(hr / 24);
      return days === 1 ? "1 day ago" : days + " days ago";
    }

    function getCurrentCampWeek(state) {
      const today = new Date();
      for (let i = 0; i < (state.campCalendar || []).length; ++i) {
        const week = state.campCalendar[i];
        const start = new Date(week.start);
        const end = new Date(week.end);
        if (today >= start && today <= end) return { ...week, idx: i };
      }
      for (let i = 0; i < (state.campCalendar || []).length; ++i) {
        const week = state.campCalendar[i];
        if (new Date(week.start) > today) return { ...week, idx: i };
      }
      return state.campCalendar && state.campCalendar[state.campCalendar.length - 1] || null;
    }

    // ================= STATE & LOCALSTORAGE ==================
    const state = {
      activeTab: 'dashboard',
      mobileMenuOpen: false,
      isAdmin: false,
      showAdminLogin: false,
      adminPassword: '',
      showNewPostForm: false,
      showNewFileForm: false,
      editingPost: null,
      expandedPost: null,
      homepageHeroTitle: 'Welcome to IVTV Summer Camp',
      homepageHeroSubtitle: 'Professional TV Production Training â€¢ Summer 2025',
      homepageBoxes: [
        {}, {}, {
          title: "Files Shared",
          icon: "FileText",
          text: "Equipment lists and project guidelines",
          bottomLabel: "Total files:",
          bottomValue: () => state.files.length
        }
      ],
      instructors: [
        { name: "Sarah Johnson", title: "Camera & Lighting Specialist", initial: "S" },
        { name: "Mike Chen", title: "Audio & Post-Production", initial: "M" }
      ],
      campStats: [
        { label: "Total Students:", value: "24" },
        { label: "Projects Started:", value: "8" },
        { label: "Skills Workshops:", value: "12" },
        { label: "Days Remaining:", value: "12", highlight: true }
      ],
      posts: [
        {
          id: 1,
          type: 'video',
          title: 'Day 1: Camera Basics Workshop',
          content: 'Students learned the fundamentals of camera operation and composition.',
          author: 'Instructor Sarah',
          date: '2025-07-01T09:00:00',
          likes: 15,
          comments: 3,
          thumbnail: 'https://placehold.co/400x225'
        },
        {
          id: 2,
          type: 'photo',
          title: 'Behind the Scenes: Set Design',
          content: 'Amazing creativity from our campers designing their first TV set!',
          author: 'Instructor Mike',
          date: '2025-07-02T16:00:00',
          likes: 22,
          comments: 8,
          thumbnail: 'https://placehold.co/400x300'
        },
        {
          id: 3,
          type: 'blog',
          title: 'Week 1 Progress Report',
          content: 'This week our campers have made incredible progress learning the fundamentals of television production. From camera operation to lighting techniques, every student is developing their unique creative voice.',
          author: 'Camp Director',
          date: '2025-07-03T18:00:00',
          likes: 28,
          comments: 12
        }
      ],
      files: [
        {
          id: 1,
          name: 'Camp_Schedule_Week1.pdf',
          type: 'pdf',
          size: '2.3 MB',
          uploadDate: '2025-07-01'
        },
        {
          id: 2,
          name: 'Equipment_List.docx',
          type: 'doc',
          size: '1.1 MB',
          uploadDate: '2025-07-02'
        },
        {
          id: 3,
          name: 'Student_Projects_Guidelines.pdf',
          type: 'pdf',
          size: '3.2 MB',
          uploadDate: '2025-07-03'
        }
      ],
      campCalendar: [
        { start: "2025-07-01", end: "2025-07-05", theme: "Camera & Lighting", },
        { start: "2025-07-06", end: "2025-07-12", theme: "Editing & Post-Production" },
        { start: "2025-07-13", end: "2025-07-19", theme: "On-Air Presentation" }
      ],
      editingHomepage: false,
      editingCommunity: false,
      editingCalendar: false,
      // Extra pages state:
      recapShorts: {
        videos: [
          { title: "Week 1 Recap", youtube: "dQw4w9WgXcQ", thumb: "https://img.youtube.com/vi/dQw4w9WgXcQ/hqdefault.jpg" }
        ],
        desc: "Catch up with the best moments from each week of camp! More shorts coming soon."
      },
      studentVideos: [
        { title: "News Flash by Team Alpha", desc: "A creative newscast project by our campers!", youtube: "STUDENT_VIDEO_ID_1", thumb: "" },
        { title: "Behind the Scenes by Team Beta", desc: "Documentary on camp life and teamwork.", youtube: "STUDENT_VIDEO_ID_2", thumb: "" }
      ],
      studentGallery: [
        { url: "https://placehold.co/400x300", caption: "Team Alpha hard at work" },
        { url: "https://placehold.co/400x300", caption: "Fun with lighting" }
      ],
      countdown: { nextWeekStart: "2025-07-07T09:00:00", desc: "Get ready for the next chapter of your camp adventure!" },
      weekExpect: [
        { title: "Week 1: Camera & Lighting", desc: "Hands-on training with cameras, composition, lighting, and fundamentals of visual storytelling. Expect workshops, group activities, and your first recording projects!" },
        { title: "Week 2: Editing & Post-Production", desc: "Dive into video editing, sound design, and special effects. You'll learn how to turn raw footage into a finished program using industry tools." },
        { title: "Week 3: On-Air Presentation", desc: "Step in front of the camera! Practice live presentation, teleprompter reading, and more to hone your on-screen presence." }
      ]
    };

    // --- Load saved state from localStorage if available ---
    let saved = localStorage.getItem('ivtvCampState');
    if (saved) {
      try {
        Object.assign(state, JSON.parse(saved));
      } catch (e) {
        // If localStorage is corrupted, ignore and start fresh
      }
    }

    // --- setState now also persists to localStorage ---
    function setState(newValues) {
      Object.assign(state, newValues);
      try {
        localStorage.setItem('ivtvCampState', JSON.stringify(state));
      } catch (e) {
        // Ignore quota exceeded or private mode
      }
      renderApp();
    }

    // --- State Logic/Setters ---
    function handleAdminLogin() {
      if (state.adminPassword === 'IVTVRules123!') {
        setState({isAdmin: true, showAdminLogin: false, adminPassword: ''});
      } else {
        alert('Incorrect password');
      }
    }

    function handleAdminLogout() {
      setState({isAdmin: false, activeTab: 'dashboard'});
    }

    function handleNewPost(form) {
      const postData = Object.fromEntries(new FormData(form));
      const newPost = {
        id: state.posts.length + 1,
        ...postData,
        date: new Date().toISOString(),
        likes: 0,
        comments: 0
      };
      setState({posts: [newPost, ...state.posts], showNewPostForm: false});
    }

    function handleEditPost(form) {
      const postData = Object.fromEntries(new FormData(form));
      setState({
        posts: state.posts.map(post => post.id == state.editingPost.id ? {...post, ...postData} : post),
        editingPost: null
      });
    }

    function handleDeletePost(postId) {
      if (confirm('Are you sure you want to delete this post?')) {
        setState({posts: state.posts.filter(post => post.id != postId)});
      }
    }

    function handleNewFile(form) {
      const fileData = Object.fromEntries(new FormData(form));
      const newFile = {
        id: state.files.length + 1,
        ...fileData,
        uploadDate: new Date().toISOString().split('T')[0]
      };
      setState({files: [newFile, ...state.files], showNewFileForm: false});
    }

    function handleDeleteFile(fileId) {
      if (confirm('Are you sure you want to delete this file?')) {
        setState({files: state.files.filter(file => file.id != fileId)});
      }
    }

    function expandPost(postId) {
      const post = state.posts.find(p => p.id == postId);
      setState({expandedPost: post});
    }

    function closeExpandedPost() {
      setState({expandedPost: null});
    }

    function addInstructor() {
      state.instructors.push({ name: "", title: "", initial: "" });
      renderApp();
    }

    function removeInstructor(idx) {
      state.instructors.splice(idx, 1);
      renderApp();
    }

    function addCalendarWeek() {
      state.campCalendar.push({ start: "", end: "", theme: "" });
      renderApp();
    }

    function removeCalendarWeek(idx) {
      state.campCalendar.splice(idx, 1);
      renderApp();
    }

    // Dynamic homepage boxes
    function getHomepageBoxes() {
      const week = getCurrentCampWeek(state);
      let today = new Date();
      let daysLeft = 0;
      if (week) {
        const start = new Date(week.start);
        const end = new Date(week.end);
        daysLeft = Math.max(0, Math.ceil((end - today) / (1000*60*60*24)) + 1);
      }
      const thisWeekBox = {
        title: week ? week.theme : "This Week",
        icon: "Video",
        text: week ? `Theme: ${week.theme}` : "No theme scheduled",
        bottomLabel: "Days Left:",
        bottomValue: week ? daysLeft : "N/A"
      };
      const lastPost = state.posts.length ? state.posts[0] : null;
      const lastUpdateBox = {
        title: "Recent Activity",
        icon: "Bell",
        text: `${state.posts.length} new posts from instructors`,
        bottomLabel: "Last update:",
        bottomValue: lastPost ? getTimeAgo(lastPost.date) : "No posts"
      };
      const filesBox = state.homepageBoxes[2];
      return [thisWeekBox, lastUpdateBox, filesBox];
    }

    function handleSaveHomepage(form) {
      const data = Object.fromEntries(new FormData(form));
      setState({
        homepageHeroTitle: data.heroTitle,
        homepageHeroSubtitle: data.heroSubtitle,
        homepageBoxes: [
          { title: data.box1Title, icon: data.box1Icon, text: data.box1Text, bottomLabel: data.box1BottomLabel, bottomValue: data.box1BottomValue },
          { title: data.box2Title, icon: data.box2Icon, text: data.box2Text, bottomLabel: data.box2BottomLabel, bottomValue: data.box2BottomValue },
          state.homepageBoxes[2]
        ],
        editingHomepage: false
      });
    }

    function handleSaveCommunity(form) {
      const data = Object.fromEntries(new FormData(form));
      const newInstructors = [];
      for (let i = 0; i < state.instructors.length; ++i) {
        newInstructors.push({
          initial: data[`instInitial${i}`],
          name: data[`instName${i}`],
          title: data[`instTitle${i}`]
        });
      }
      const newCampStats = [];
      for (let i = 0; i < state.campStats.length; ++i) {
        newCampStats.push({
          label: data[`statLabel${i}`],
          value: data[`statValue${i}`],
          highlight: !!data[`statHighlight${i}`]
        });
      }
      setState({
        instructors: newInstructors,
        campStats: newCampStats,
        editingCommunity: false
      });
    }

    function handleSaveCalendar(form) {
      const data = Object.fromEntries(new FormData(form));
      const newCalendar = [];
      for (let i = 0; i < state.campCalendar.length; ++i) {
        newCalendar.push({
          start: data[`start${i}`],
          end: data[`end${i}`],
          theme: data[`theme${i}`]
        });
      }
      setState({
        campCalendar: newCalendar,
        editingCalendar: false
      });
    }

    // ================= COMPONENTS ==================
    function Navigation() {
      const tabs = [
        { id: 'dashboard', label: 'Dashboard', icon: SVG.Bell },
        { id: 'recapShorts', label: 'Recap Shorts', icon: SVG.Video },
        { id: 'studentVideos', label: 'Student Videos', icon: SVG.Camera },
        { id: 'studentGallery', label: 'Student Gallery', icon: SVG.Camera },
        { id: 'weekByWeek', label: 'Week-by-Week', icon: SVG.Calendar },
        { id: 'community', label: 'Community', icon: SVG.Users },
        { id: 'files', label: 'Files', icon: SVG.FileText },
      ];

      return `
        <nav class="bg-red-600 text-white p-4 shadow-md">
          <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="text-xl font-bold">IVTV Summer Camp</div>
            <div class="md:hidden">
              <button onclick="setState({mobileMenuOpen: !state.mobileMenuOpen})" class="text-white focus:outline-none">
                ${state.mobileMenuOpen ? SVG.X : SVG.Menu}
              </button>
            </div>
            <ul class="hidden md:flex space-x-6">
              ${tabs.map(tab => `
                <li>
                  <a href="#" onclick="setState({activeTab: '${tab.id}'})"
                    class="flex items-center space-x-2 pb-1 ${state.activeTab === tab.id ? 'border-b-2 border-white' : 'hover:border-b-2 hover:border-white hover:border-opacity-50'}">
                    ${tab.icon}<span>${tab.label}</span>
                  </a>
                </li>
              `).join('')}
              ${state.isAdmin ? `
                <li><a href="#" onclick="setState({showAdminLogin: true})" class="flex items-center space-x-2 pb-1 hover:border-b-2 hover:border-white hover:border-opacity-50">${SVG.Users}<span>Admin</span></a></li>
                <li><a href="#" onclick="handleAdminLogout()" class="flex items-center space-x-2 pb-1 hover:border-b-2 hover:border-white hover:border-opacity-50">${SVG.X}<span>Logout</span></a></li>
              ` : `
                <li><a href="#" onclick="setState({showAdminLogin: true})" class="flex items-center space-x-2 pb-1 hover:border-b-2 hover:border-white hover:border-opacity-50">${SVG.Users}<span>Admin Login</span></a></li>
              `}
            </ul>
          </div>
          ${state.mobileMenuOpen ? `
            <ul class="md:hidden mt-4 space-y-2">
              ${tabs.map(tab => `
                <li>
                  <a href="#" onclick="setState({activeTab: '${tab.id}', mobileMenuOpen: false})"
                    class="flex items-center space-x-2 p-2 rounded hover:bg-red-700 ${state.activeTab === tab.id ? 'bg-red-700' : ''}">
                    ${tab.icon}<span>${tab.label}</span>
                  </a>
                </li>
              `).join('')}
              ${state.isAdmin ? `
                <li><a href="#" onclick="setState({showAdminLogin: true, mobileMenuOpen: false})" class="flex items-center space-x-2 p-2 rounded hover:bg-red-700">${SVG.Users}<span>Admin</span></a></li>
                <li><a href="#" onclick="handleAdminLogout(); setState({mobileMenuOpen: false});" class="flex items-center space-x-2 p-2 rounded hover:bg-red-700">${SVG.X}<span>Logout</span></a></li>
              ` : `
                <li><a href="#" onclick="setState({showAdminLogin: true, mobileMenuOpen: false})" class="flex items-center space-x-2 p-2 rounded hover:bg-red-700">${SVG.Users}<span>Admin Login</span></a></li>
              `}
            </ul>
          ` : ''}
        </nav>
      `;
    }

    function HeroSection() {
      return `
        <section class="bg-gray-100 py-12 text-center rounded-lg shadow-sm mb-8">
          <h1 class="text-4xl font-bold text-gray-800 mb-2">${state.homepageHeroTitle}</h1>
          <p class="text-xl text-gray-600">${state.homepageHeroSubtitle}</p>
          ${state.isAdmin ? `<button onclick="setState({editingHomepage: true})" class="mt-4 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Edit Hero</button>` : ''}
        </section>
      `;
    }

    function InfoBoxes() {
      const boxes = getHomepageBoxes();
      return `
        <section class="grid md:grid-cols-3 gap-6 mb-8">
          ${boxes.map((box, idx) => `
            <div class="bg-white p-6 rounded-lg shadow-md flex items-start space-x-4">
              <div class="p-3 bg-red-100 text-red-600 rounded-full">
                ${SVG[box.icon]}
              </div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">${box.title}</h3>
                <p class="text-gray-600 text-sm mb-3">${box.text}</p>
                <div class="text-gray-500 text-xs">${box.bottomLabel} <span class="font-bold text-gray-700">${typeof box.bottomValue === 'function' ? box.bottomValue() : box.bottomValue}</span></div>
              </div>
            </div>
          `).join('')}
        </section>
      `;
    }

    function CommunityPosts() {
      return `
        <section class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex justify-between items-center">
            Community Feed
            ${state.isAdmin ? `
              <button onclick="setState({showNewPostForm: true})" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center space-x-2">
                ${SVG.Upload}<span>New Post</span>
              </button>
            ` : ''}
          </h2>
          <div class="space-y-6">
            ${state.posts.length === 0 ? `<p class="text-gray-500">No posts yet. Be the first to share something!</p>` : ''}
            ${state.posts.map(post => `
              <div class="bg-white p-6 rounded-lg shadow-md">
                ${post.thumbnail ? `<img src="${post.thumbnail}" alt="${post.title}" class="w-full h-48 object-cover rounded-md mb-4 cursor-pointer" onclick="expandPost(${post.id})"/>` : ''}
                <div class="flex justify-between items-center mb-2">
                  <h3 class="text-xl font-semibold text-gray-800 cursor-pointer hover:text-red-600" onclick="expandPost(${post.id})">${post.title}</h3>
                  ${state.isAdmin ? `
                    <div class="flex space-x-2">
                      <button onclick="setState({editingPost: ${JSON.stringify(post).replace(/"/g, '&quot;')}})" class="text-sm text-gray-500 hover:text-blue-600">Edit</button>
                      <button onclick="handleDeletePost(${post.id})" class="text-sm text-red-500 hover:text-red-700">Delete</button>
                    </div>
                  ` : ''}
                </div>
                <p class="text-gray-700 text-sm mb-3">${post.content}</p>
                <div class="flex items-center text-gray-500 text-xs justify-between">
                  <span>${post.author} â€¢ ${getTimeAgo(post.date)}</span>
                  <div class="flex space-x-3">
                    <span class="flex items-center space-x-1">${SVG.Heart} ${post.likes}</span>
                    <span class="flex items-center space-x-1">${SVG.MessageCircle} ${post.comments}</span>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function FilesSection() {
      return `
        <section>
          <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex justify-between items-center">
            Shared Files
            ${state.isAdmin ? `
              <button onclick="setState({showNewFileForm: true})" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center space-x-2">
                ${SVG.Upload}<span>Upload File</span>
              </button>
            ` : ''}
          </h2>
          <div class="bg-white rounded-lg shadow-md p-6">
            ${state.files.length === 0 ? `<p class="text-gray-500">No files shared yet.</p>` : ''}
            <ul class="divide-y divide-gray-200">
              ${state.files.map(file => `
                <li class="py-4 flex items-center justify-between">
                  <div class="flex items-center space-x-3">
                    ${SVG.FileTextLarge}
                    <div>
                      <div class="font-medium text-gray-900">${file.name}</div>
                      <div class="text-sm text-gray-500">${file.size} â€¢ Uploaded on ${file.uploadDate}</div>
                    </div>
                  </div>
                  <div class="flex items-center space-x-4">
                    <a href="#" class="text-red-600 hover:text-red-800">${SVG.Download}</a>
                    ${state.isAdmin ? `
                      <button onclick="handleDeleteFile(${file.id})" class="text-red-500 hover:text-red-700 text-sm">Delete</button>
                    ` : ''}
                  </div>
                </li>
              `).join('')}
            </ul>
          </div>
        </section>
      `;
    }

    function CommunityPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-6 flex justify-between items-center">
            Meet the Team
            ${state.isAdmin ? `<button onclick="setState({editingCommunity: true})" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Edit Community</button>` : ''}
          </h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            ${state.instructors.map(instructor => `
              <div class="bg-white p-6 rounded-lg shadow-md text-center">
                <div class="w-24 h-24 bg-red-200 text-red-700 rounded-full flex items-center justify-center text-4xl font-bold mx-auto mb-4">${instructor.initial}</div>
                <h3 class="text-xl font-semibold text-gray-800">${instructor.name}</h3>
                <p class="text-red-600 text-sm">${instructor.title}</p>
              </div>
            `).join('')}
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-6">Camp Statistics</h2>
          <div class="bg-white rounded-lg shadow-md p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            ${state.campStats.map(stat => `
              <div class="text-center p-4 border rounded-lg ${stat.highlight ? 'border-red-500 bg-red-50 text-red-700' : 'border-gray-200'}">
                <div class="text-sm font-medium">${stat.label}</div>
                <div class="text-2xl font-bold">${stat.value}</div>
              </div>
            `).join('')}
          </div>
        </section>
        ${CommunityPosts()}
      `;
    }

    function WeekByWeekPage() {
      const currentWeek = getCurrentCampWeek(state);
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-6 flex justify-between items-center">
            Weekly Program
            ${state.isAdmin ? `<button onclick="setState({editingCalendar: true})" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Edit Calendar</button>` : ''}
          </h2>
          <div class="space-y-6">
            ${state.campCalendar.length === 0 ? `<p class="text-gray-500">No calendar weeks defined yet.</p>` : ''}
            ${state.campCalendar.map((week, idx) => `
              <div class="bg-white p-6 rounded-lg shadow-md ${currentWeek && currentWeek.idx === idx ? 'border-2 border-red-600' : ''}">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Week ${idx + 1}: ${week.theme}</h3>
                <p class="text-gray-600 text-sm mb-3">${new Date(week.start).toLocaleDateString()} - ${new Date(week.end).toLocaleDateString()}</p>
              </div>
            `).join('')}
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mt-8 mb-6">What to Expect</h2>
          <div class="space-y-6">
            ${state.weekExpect.map(item => `
              <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">${item.title}</h3>
                <p class="text-gray-700 text-sm">${item.desc}</p>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function RecapShortsPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-6">Recap Shorts</h2>
          <p class="text-gray-700 mb-6">${state.recapShorts.desc}</p>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${state.recapShorts.videos.map(video => `
              <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="relative pb-[56.25%] h-0">
                  <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${video.youtube}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="p-4">
                  <h3 class="text-lg font-semibold text-gray-800">${video.title}</h3>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function StudentVideosPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-6">Student Videos</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${state.studentVideos.map(video => `
              <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="relative pb-[56.25%] h-0">
                  <div class="absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-200 text-gray-500">
                    ${SVG.VideoLarge}
                    <span class="ml-2 text-lg">Video Placeholder</span>
                  </div>
                </div>
                <div class="p-4">
                  <h3 class="text-lg font-semibold text-gray-800">${video.title}</h3>
                  <p class="text-gray-700 text-sm">${video.desc}</p>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function StudentGalleryPage() {
      return `
        <section class="mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-6">Student Gallery</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${state.studentGallery.map((item, idx) => `
              <div class="bg-white rounded-lg shadow-md overflow-hidden cursor-pointer" onclick="openLightbox('${item.url}', '${item.caption.replace(/'/g, "\\'")}')">
                <img src="${item.url}" alt="${item.caption}" class="w-full h-48 object-cover"/>
                <div class="p-4">
                  <p class="text-gray-700 text-sm">${item.caption}</p>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function CountdownSection() {
      return `
        <section class="text-center bg-red-600 text-white p-6 rounded-lg shadow-md mb-8">
          <h2 class="text-xl font-bold mb-2">Next Week Starts In:</h2>
          <div id="countdown-timer" class="text-5xl font-extrabold mb-2"></div>
          <p class="text-lg">${state.countdown.desc}</p>
        </section>
      `;
    }

    function Homepage() {
      return `
        ${HeroSection()}
        ${InfoBoxes()}
        ${CommunityPosts()}
      `;
    }

    // ================= MODALS ==================
    function renderAdminLogin() {
      if (!state.showAdminLogin) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-sm mx-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Admin Login</h3>
            <input type="password" placeholder="Password" class="border border-gray-300 p-2 w-full rounded mb-4" oninput="setState({adminPassword: this.value})" value="${state.adminPassword}"/>
            <div class="flex space-x-2">
              <button onclick="handleAdminLogin()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 w-full">Login</button>
              <button onclick="setState({showAdminLogin: false, adminPassword: ''})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 w-full">Cancel</button>
            </div>
          </div>
        </div>
      `;
    }

    function NewPostModal() {
      if (!state.showNewPostForm) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleNewPost(this);" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Create New Post</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Title</label>
              <input type="text" name="title" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Content</label>
              <textarea name="content" class="mt-1 p-2 w-full border border-gray-300 rounded-md" rows="4" required></textarea>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Author</label>
              <input type="text" name="author" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Type</label>
              <select name="type" class="mt-1 p-2 w-full border border-gray-300 rounded-md">
                <option value="blog">Blog Post</option>
                <option value="video">Video</option>
                <option value="photo">Photo</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Thumbnail URL (Optional)</label>
              <input type="url" name="thumbnail" class="mt-1 p-2 w-full border border-gray-300 rounded-md"/>
            </div>
            <div class="flex space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Create Post</button>
              <button type="button" onclick="setState({showNewPostForm: false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function EditPostModal() {
      if (!state.editingPost) return '';
      const post = state.editingPost;
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleEditPost(this);" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Post</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Title</label>
              <input type="text" name="title" value="${post.title.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Content</label>
              <textarea name="content" class="mt-1 p-2 w-full border border-gray-300 rounded-md" rows="4" required>${post.content}</textarea>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Author</label>
              <input type="text" name="author" value="${post.author.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Type</label>
              <select name="type" class="mt-1 p-2 w-full border border-gray-300 rounded-md">
                <option value="blog" ${post.type === 'blog' ? 'selected' : ''}>Blog Post</option>
                <option value="video" ${post.type === 'video' ? 'selected' : ''}>Video</option>
                <option value="photo" ${post.type === 'photo' ? 'selected' : ''}>Photo</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">Thumbnail URL (Optional)</label>
              <input type="url" name="thumbnail" value="${post.thumbnail ? post.thumbnail.replace(/"/g,'&quot;') : ''}" class="mt-1 p-2 w-full border border-gray-300 rounded-md"/>
            </div>
            <div class="flex space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save Changes</button>
              <button type="button" onclick="setState({editingPost: null})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function NewFileModal() {
      if (!state.showNewFileForm) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <form onsubmit="event.preventDefault(); handleNewFile(this);" class="bg-white p-6 rounded-xl shadow-lg w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Upload New File</h3>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">File Name</label>
              <input type="text" name="name" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">File Type (e.g., pdf, docx)</label>
              <input type="text" name="type" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">File Size (e.g., 2.3 MB)</label>
              <input type="text" name="size" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
            </div>
            <div class="flex space-x-2">
              <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Upload File</button>
              <button type="button" onclick="setState({showNewFileForm: false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            </div>
          </form>
        </div>
      `;
    }

    function ExpandedPostModal() {
      if (!state.expandedPost) return '';
      const post = state.expandedPost;
      let mediaContent = '';
      if (post.type === 'video' && post.thumbnail) {
        // Assuming thumbnail is a direct YouTube embed link or similar for simplicity
        // For actual YouTube videos, you'd parse the ID and use an iframe
        mediaContent = `<div class="relative pb-[56.25%] h-0 mb-4"><iframe class="absolute top-0 left-0 w-full h-full" src="${post.thumbnail.replace('hqdefault.jpg', 'maxresdefault.jpg').replace('https://img.youtube.com/vi/', 'https://www.youtube.com/embed/')}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
      } else if (post.type === 'photo' && post.thumbnail) {
        mediaContent = `<img src="${post.thumbnail}" alt="${post.title}" class="w-full h-64 object-contain rounded-md mb-4"/>`;
      }

      return `
        <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onclick="closeExpandedPost()">
          <div class="bg-white p-6 rounded-xl shadow-lg max-w-3xl w-full mx-4" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-2xl font-bold text-gray-800">${post.title}</h2>
              <button onclick="closeExpandedPost()" class="text-gray-500 hover:text-gray-700">${SVG.X}</button>
            </div>
            ${mediaContent}
            <p class="text-gray-700 text-base mb-4">${post.content}</p>
            <div class="text-gray-500 text-sm flex justify-between items-center">
              <span>By ${post.author} â€¢ ${getTimeAgo(post.date)}</span>
              <div class="flex space-x-4">
                <span class="flex items-center space-x-1">${SVG.Heart} ${post.likes}</span>
                <span class="flex items-center space-x-1">${SVG.MessageCircle} ${post.comments}</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function openLightbox(imageUrl, caption) {
      setState({ lightbox: { isOpen: true, imageUrl, caption } });
    }

    function closeLightbox() {
      setState({ lightbox: { isOpen: false, imageUrl: '', caption: '' } });
    }

    function LightBox() {
      if (!state.lightbox || !state.lightbox.isOpen) return '';
      return `
        <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onclick="closeLightbox()">
          <div class="relative p-4 max-w-screen-lg max-h-screen" onclick="event.stopPropagation()">
            <img src="${state.lightbox.imageUrl}" alt="${state.lightbox.caption}" class="max-w-full max-h-full object-contain mx-auto rounded-lg shadow-lg"/>
            <p class="text-white text-center mt-4">${state.lightbox.caption}</p>
            <button onclick="closeLightbox()" class="absolute top-4 right-4 text-white text-3xl">&times;</button>
          </div>
        </div>
      `;
    }

    function EditHomepageModal() {
      if (!state.editingHomepage) return '';
      const boxes = getHomepageBoxes(); // Use current values for editing
      return `
      <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <form id="edit-homepage-form" onsubmit="event.preventDefault(); handleSaveHomepage(this);" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Homepage Content</h3>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Hero Title</label>
            <input type="text" name="heroTitle" value="${state.homepageHeroTitle.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">Hero Subtitle</label>
            <input type="text" name="heroSubtitle" value="${state.homepageHeroSubtitle.replace(/"/g,'&quot;')}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required/>
          </div>
          <div class="mb-4">
            <h4 class="text-lg font-semibold text-gray-800 mb-2">Info Boxes</h4>
            ${boxes.slice(0,2).map((box, idx) => `
              <div class="mb-4 border rounded-lg p-3">
                <label class="text-xs font-bold block mb-1">Box ${idx + 1}</label>
                <input type="text" name="box${idx+1}Title" value="${box.title.replace(/"/g,'&quot;')}" class="w-full p-1 border border-gray-200 rounded mb-1" placeholder="Title"/>
                <input type="text" name="box${idx+1}Icon" value="${box.icon}" class="w-full p-1 border border-gray-200 rounded mb-1" placeholder="Icon Name (e.g., Camera, Video, Bell)"/>
                <input type="text" name="box${idx+1}Text" value="${box.text.replace(/"/g,'&quot;')}" class="w-full p-1 border border-gray-200 rounded mb-1" placeholder="Text"/>
                <input type="text" name="box${idx+1}BottomLabel" value="${box.bottomLabel.replace(/"/g,'&quot;')}" class="w-full p-1 border border-gray-200 rounded mb-1" placeholder="Bottom Label"/>
                <input type="text" name="box${idx+1}BottomValue" value="${typeof box.bottomValue === 'function' ? '' : box.bottomValue}" class="w-full p-1 border border-gray-200 rounded" placeholder="Bottom Value (leave empty for dynamic)"/>
              </div>
            `).join('')}
          </div>
          <div class="flex space-x-2">
            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
            <button type="button" onclick="setState({editingHomepage:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
          </div>
        </form>
      </div>
      `;
    }

    function EditCommunityModal() {
      return `
      <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <form id="edit-community-form" onsubmit="event.preventDefault(); handleSaveCommunity(this);" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Community</h3>
          <div class="mb-6">
            <label class="block text-sm font-semibold mb-2">Instructors</label>
            ${state.instructors.map((inst, idx) => `
              <div class="mb-4 border rounded-lg p-3">
                <label class="text-xs font-bold block mb-1">Instructor ${idx+1}</label>
                <div class="flex gap-2">
                  <input type="text" name="instInitial${idx}" value="${inst.initial}" class="w-12 mr-2 p-1 border border-gray-200 rounded" placeholder="Initial" maxlength="1"/>
                  <input type="text" name="instName${idx}" value="${inst.name.replace(/"/g,'&quot;')}" class="w-1/3 mr-2 p-1 border border-gray-200 rounded" placeholder="Name"/>
                  <input type="text" name="instTitle${idx}" value="${inst.title.replace(/"/g,'&quot;')}" class="w-1/2 p-1 border border-gray-200 rounded" placeholder="Title"/>
                </div>
                <button type="button" onclick="removeInstructor(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
              </div>
            `).join('')}
            <button type="button" onclick="addInstructor()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Instructor</button>
          </div>
          <div class="mb-6">
            <label class="block text-sm font-semibold mb-2">Camp Stats</label>
            ${state.campStats.map((stat, idx) => `
              <div class="mb-2 flex items-center">
                <input type="text" name="statLabel${idx}" value="${stat.label.replace(/"/g,'&quot;')}" class="w-1/2 mr-2 p-1 border border-gray-200 rounded" placeholder="Label"/>
                <input type="text" name="statValue${idx}" value="${stat.value.replace(/"/g,'&quot;')}" class="w-1/4 mr-2 p-1 border border-gray-200 rounded" placeholder="Value"/>
                <label class="text-xs flex items-center space-x-1">
                  <input type="checkbox" name="statHighlight${idx}" ${stat.highlight ? "checked" : ""}/>
                  <span>Red</span>
                </label>
              </div>
            `).join('')}
          </div>
          <div class="flex space-x-2">
            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
            <button type="button" onclick="setState({editingCommunity:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
          </div>
        </form>
      </div>
      `;
    }

    function EditCalendarModal() {
      return `
      <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <form id="edit-calendar-form" onsubmit="event.preventDefault(); handleSaveCalendar(this);" class="bg-white p-6 rounded-xl shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Camp Calendar</h3>
          <div class="mb-4">
            ${state.campCalendar.map((week, idx) => `
              <div class="mb-4 border rounded-lg p-3">
                <label class="text-xs font-bold block mb-1">Week ${idx+1}</label>
                <div class="flex gap-2">
                  <input type="date" name="start${idx}" value="${week.start}" class="p-1 border border-gray-200 rounded" required/>
                  <span class="mt-2">to</span>
                  <input type="date" name="end${idx}" value="${week.end}" class="p-1 border border-gray-200 rounded" required/>
                </div>
                <input type="text" name="theme${idx}" value="${week.theme.replace(/"/g,'&quot;')}" class="w-full p-1 mt-2 border border-gray-200 rounded" placeholder="Theme/Title"/>
                <button type="button" onclick="removeCalendarWeek(${idx})" class="mt-2 text-xs text-red-600 hover:underline">Remove</button>
              </div>
            `).join('')}
          </div>
          <button type="button" onclick="addCalendarWeek()" class="mb-4 bg-gray-200 text-gray-800 px-3 py-1 rounded">Add Week</button>
          <div class="flex space-x-2">
            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Save</button>
            <button type="button" onclick="setState({editingCalendar:false})" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
          </div>
        </form>
      </div>
      `;
    }

    // ================= MAIN RENDER FUNCTION ===================
    window.renderApp = function() {
      const container = document.getElementById('app');
      container.innerHTML = `
        ${Navigation()}
        <main class="max-w-6xl mx-auto px-4 py-8">
          ${
            state.activeTab === 'dashboard' ? (CountdownSection() + `<div class="text-center text-gray-500 mt-12">Welcome to the IVTV Summer Camp Dashboard.<br>Use the navigation above to explore Recap Shorts, Student Videos, Gallery, and Week-by-Week info.</div>` + Homepage()) :
            state.activeTab === 'recapShorts' ? RecapShortsPage() :
            state.activeTab === 'studentVideos' ? StudentVideosPage() :
            state.activeTab === 'studentGallery' ? StudentGalleryPage() :
            state.activeTab === 'weekByWeek' ? WeekByWeekPage() :
            state.activeTab === 'community' ? CommunityPage() :
            state.activeTab === 'files' ? FilesSection() :
            `<div class="text-center text-gray-500">Page not found.</div>`
          }
        </main>
      `;

      // Render Modals separately outside #app to handle z-index and overlays
      const editModalRoot = document.getElementById('edit-modal-root');
      if (editModalRoot) {
        editModalRoot.innerHTML = `
          ${renderAdminLogin()}
          ${NewPostModal()}
          ${EditPostModal()}
          ${NewFileModal()}
          ${ExpandedPostModal()}
          ${state.editingHomepage ? EditHomepageModal() : ''}
          ${state.editingCommunity ? EditCommunityModal() : ''}
          ${state.editingCalendar ? EditCalendarModal() : ''}
        `;
      }
      const lightboxRoot = document.getElementById('lightbox-root');
      if (lightboxRoot) {
        lightboxRoot.innerHTML = LightBox();
      }

      // Add dynamic updates and event listeners
      if (state.activeTab === "dashboard") {
        if (window.homepageTimer) clearInterval(window.homepageTimer);
        window.homepageTimer = setInterval(() => {
          const box1 = document.getElementById("dynamic-homepage-box1"); // This ID is not present in the HTML structures, so this will not update. If it needs to be dynamic, a proper ID needs to be added to one of the homepage boxes.
          const lastPost = state.posts.length ? state.posts[0] : null;
          if (box1 && lastPost) box1.textContent = getTimeAgo(lastPost.date);
        }, 1000);
      } else {
        if (window.homepageTimer) {
          clearInterval(window.homepageTimer);
          window.homepageTimer = null;
        }
      }
      // Modal close on ESC for expanded post
      if (state.expandedPost) {
        document.addEventListener('keydown', onKeyDownExpandModal);
      } else {
        document.removeEventListener('keydown', onKeyDownExpandModal);
      }
    };

    function onKeyDownExpandModal(e) {
      if (e.key === "Escape") closeExpandedPost();
    }

    function updateCountdown() {
      const now = new Date();
      const target = new Date(state.countdown.nextWeekStart);
      let diff = (target - now) / 1000;
      if (diff < 0) diff = 0;
      const days = Math.floor(diff / (3600*24));
      const hours = Math.floor((diff % (3600*24)) / 3600);
      const minutes = Math.floor((diff % 3600) / 60);
      const seconds = Math.floor(diff % 60);
      const e = document.getElementById('countdown-timer');
      if (e) e.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }
    setInterval(updateCountdown, 1000);

    // Expose functions for global onclick
    window.setState = setState;
    window.handleAdminLogin = handleAdminLogin;
    window.handleAdminLogout = handleAdminLogout;
    window.handleDeletePost = handleDeletePost;
    window.handleDeleteFile = handleDeleteFile;
    window.expandPost = expandPost;
    window.closeExpandedPost = closeExpandedPost;
    window.addInstructor = addInstructor;
    window.removeInstructor = removeInstructor;
    window.addCalendarWeek = addCalendarWeek;
    window.removeCalendarWeek = removeCalendarWeek;
    window.openLightbox = openLightbox;
    window.closeLightbox = closeLightbox;
    window.handleSaveHomepage = handleSaveHomepage;
    window.handleSaveCommunity = handleSaveCommunity;
    window.handleSaveCalendar = handleSaveCalendar;

    // Initial render
    renderApp();
  </script>
</body>
</html>
